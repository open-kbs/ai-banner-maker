(()=>{"use strict";var e={};(()=>{e.d=(t,a)=>{for(var o in a){if(e.o(a,o)&&!e.o(t,o)){Object.defineProperty(t,o,{enumerable:true,get:a[o]})}}}})();(()=>{e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})();(()=>{e.r=e=>{if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})}})();if(typeof e!=="undefined")e.ab=__dirname+"/";var t={};e.r(t);e.d(t,{handler:()=>handler});const getActions=e=>[[/\/?textToImage\("([^"]*)"(?:,\s*"([^"]*)")?\)/,async t=>{const a=!"{{variables.defaultImageToTextModel}}".startsWith("{{");const o=await openkbs.textToImage(t[1],{negative_prompt:t[2],serviceId:a?"{{variables.defaultImageToTextModel}}":undefined});const n=`data:${o.ContentType};base64,${o.base64Data}`;return{type:"SAVED_CHAT_IMAGE",imageSrc:n,...e}}],[/\/?webpageToText\("(.*)"\)/,async t=>{try{let a=await openkbs.webpageToText(t[1],{parsePrice:true});if(a?.content?.length>5e3)a.content=a.content.substring(0,5e3);return{data:a,...e}}catch(t){return{error:t.response.data,...e}}}]];const handler=async e=>{const t=getActions({_meta_actions:["REQUEST_CHAT_MODEL"]});for(let[a,o]of t){const t=e.payload.messages[e.payload.messages.length-1].content;const n=t?.match(a);if(n)return await o(n)}return{type:"CONTINUE"}};module.exports=t})();